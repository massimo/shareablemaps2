rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Temporary permissive rules for development - CHANGE IN PRODUCTION!
    match /{document=**} {
      allow read, write: if true;
    }
    
    // TODO: Replace with proper authentication rules in production
    // Maps collection - users can read/write their own maps
    // match /maps/{mapId} {
    //   allow read, write: if request.auth != null && request.auth.uid == resource.data.ownerId;
    //   allow create: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
    // }
    
    // Markers collection - users can read/write markers for maps they own
    // match /markers/{markerId} {
    //   allow read, write: if request.auth != null && 
    //     request.auth.uid == resource.data.createdBy;
    //   allow create: if request.auth != null && 
    //     request.auth.uid == request.resource.data.createdBy;
    //   
    //   // Allow reading markers if user owns the parent map
    //   allow read: if request.auth != null && 
    //     exists(/databases/$(database)/documents/maps/$(resource.data.mapId)) &&
    //     get(/databases/$(database)/documents/maps/$(resource.data.mapId)).data.ownerId == request.auth.uid;
    // }
    
    // Public shared maps (read-only)
    // match /maps/{mapId} {
    //   allow read: if resource.data.isPublicLinkEnabled == true;
    // }
    
    // Public markers for shared maps (read-only)
    // match /markers/{markerId} {
    //   allow read: if exists(/databases/$(database)/documents/maps/$(resource.data.mapId)) &&
    //     get(/databases/$(database)/documents/maps/$(resource.data.mapId)).data.isPublicLinkEnabled == true;
    // }
  }
}
